cmake_minimum_required (VERSION 3.9)

project(Animal_Well_Editor C CXX)

set(CMAKE_CXX_STANDARD 20)

add_definitions(-w)

find_package(OpenGL REQUIRED)

if(WIN32)
    set(LIBS OpenGL32)
elseif(UNIX)
    find_package(PkgConfig REQUIRED)
    pkg_check_modules(GTK2 REQUIRED gtk+-2.0)

    set(INCLUDES ${GTK2_INCLUDE_DIRS})
    set(LIBS GL ${GTK2_LIBRARIES} stdc++fs pthread)

    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -maes -msse4.1")
endif()

set(GLFW_BUILD_DOCS OFF CACHE BOOL "" FORCE)
set(GLFW_BUILD_EXAMPLES OFF CACHE BOOL "" FORCE)
set(GLFW_BUILD_TESTS OFF CACHE BOOL "" FORCE)

add_subdirectory(lib/glfw)

file(GLOB_RECURSE Common_sources 
    "./src/*.cpp" "./src/**/*.cpp"
    "./src/*.hpp" "./src/**/*.hpp"
    "./src/*.ixx" "./src/**/*.ixx"
    "./src/*.h"   "./src/**/*.h"
    "./src/shaders/*")

file(GLOB imgui_sources "./lib/imgui/*.cpp")

source_group(TREE "${CMAKE_SOURCE_DIR}/src" FILES ${Common_sources})

add_executable(editor ${Common_sources} ${imgui_sources}
    "./lib/imgui/backends/imgui_impl_opengl3.cpp" 
    "./lib/imgui/backends/imgui_impl_glfw.cpp"
    "./lib/imgui/misc/cpp/imgui_stdlib.cpp"
    "./lib/glad/src/gl.c"
    "./lib/nativefiledialog/nfd.cpp")

target_include_directories(editor PRIVATE "lib/imgui" "lib/stb" "lib/glm" "lib/glad/include" "lib/nativefiledialog" glfw ${INCLUDES})
target_link_libraries(editor PRIVATE glfw ${LIBS})
set_target_properties(editor PROPERTIES WIN32_EXECUTABLE TRUE) 

add_custom_command(TARGET editor POST_BUILD
        COMMAND ${CMAKE_COMMAND} -E copy_directory
                ${CMAKE_SOURCE_DIR}/src/shaders
                ${CMAKE_CURRENT_BINARY_DIR}/shaders)
